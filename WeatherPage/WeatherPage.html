<!DOCTYPE html>

<html lang="en">
  <title>FCC Weather</title>
  
    <head>
        <!--Meta tags-->
	    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	    <meta name="description" content="Anywhere Weather App">
	    <meta name="Author" content="Clifford Crerar">
        <!--Bootstrap-->
	    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
        <!--Jquery-->
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
        <!--Bootstrap Toggle-->
        <link href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css" rel="stylesheet">
        <script src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>
        <!--font awesome-->
	    <script src="https://use.fontawesome.com/117c6a36cf.js"></script>
        <!--Skycons-->
        <script src="/Users/cliffordcrerar/Documents/GitHub/WEB1/Skycons/skycons.js"></script>
        <!--
        <script src="C:\Users\clifford.crear\Documents\GitHub\WEB1\Skycons\skycons.js"></script>-->
        
<!--JavaScript-->
        <script type="application/javascript">
        $(document).ready(function(){
            $("#toggle").attr("disabled", true); //disable toggle
            var skycons = new Skycons({"color":"white"});             

            //Image variables
            var imageURLStart = "http://tinyurl.com/yc64kz2y"
            var imageURLSunnyDay = "http://tinyurl.com/yd4rl42o"
            var imageURLColdDay = "http://tinyurl.com/y8b3owrm"
            var imageURLCloudyDay = "http://tinyurl.com/yagqrpup"
            $("body").css("background-image","url('"+imageURLStart+"')");

            //Weather Variables
            var nowSum = '';
            var nowTemp = 0;
            var nowWind = 0;
            var nowIcon = '';
            var todSum = '';
            var todWind = 0;
            var todTempMin = 0;
            var todTempMax = 0;
            var tomSum = '';
            var tomWind = 0;
            var tomTempMin = 0;
            var tomTempMax = 0;

            //variables for weather data fetch
            var posLat;
            var posLong;
            var sUrl = "https://crossorigin.me/https://api.darksky.net/forecast/";
            var encKey = "o=Fo=>ADn>nprsDCE?ror==s=qAns>qC";
            var apiLink = "";

            //get coordinates and generate API Link
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(function(position) {
                    posLat = position.coords.latitude;
                    posLong = position.coords.longitude;
                    apiLink = sUrl + decrypt(encKey) + "/" + posLat + "," + posLong + "?exclude=alerts,flags";
                    //Tempcode
                    console.log(posLat);
                    console.log(posLong);
                    //End of tempcode
                    getWeatherData(apiLink);
                });
            }

            //Get darksky object and set weather variables
            function getWeatherData(apiLink) {
                $.getJSON(apiLink, function(forecast){
                    console.log(forecast);
                    //Set all weather variables default values
                    nowSum = forecast.currently.summary;
                    nowTemp = forecast.currently.temperature;
                    nowWind = forecast.currently.windSpeed;
                    nowIcon = forecast.currently.icon
                        //nowIcon = "partly-cloudy-day"

                    todSum = forecast.daily.data[0].summary;
                    todWind = forecast.daily.data[0].windSpeed;                      
                    todTempMin = forecast.daily.data[0].temperatureMin;
                    todTempMax = forecast.daily.data[0].temperatureMax;

                    tomSum = forecast.daily.data[1].summary;
                    tomWind = forecast.daily.data[1].windSpeed;
                    tomTempMin = forecast.daily.data[1].temperatureMin;
                    tomTempMax = forecast.daily.data[1].temperatureMax;
                    
                    $('#city').html(forecast.timezone.split("/")[1]+", "+forecast.timezone.split("/")[0]) //Set Timezone

                    var Skycon = nowIcon.split("-").join("_").toUpperCase(); //convert DS data to SC data format
                    skycons.add("canvas", Skycons[Skycon]); //Set Weather icon
                    skycons.play(); //start icon animation

                    $("#summary").html(nowSum); //Set current Summary

                    var C = (((nowTemp - 32) * 5) / 9); //fahrenheit to celsius
                    var windSpeedKm = windSpeed * 1.6 //convert windspeen from miles to km per hour

                    $('#temp').html(Math.round(C)+"&deg C"); //assign temprature in C to html
                    $('#wind').html(Math.round(windSpeedKm)+" km wind") //assign windspeen in km to html

                    $("#loading").html("");
                    $("#toggle").attr("disabled", false);
                });
            }

            //Change to fahrenthiet
            $("#toggle").change(function() {
                if ($("#toggle")[0].checked) {
                    console.log("Celsius");
                    console.log(apiLink)
                    //getWeatherData(apilink,"C")
                } else {
                    console.log("Fahrentheit");
                    console.log(apiLink)
                    //getWeatherData(apilink)
                }
            });

            //Dycryption function
            function decrypt(key) {
                var keyLen = key.length;
                var oLetter = "";
                var nPos = 0;
                var nLetter = "";
                var nKey = "";

                for (i = 0; i < keyLen; i++) {
                    oLetter = key[i];
                    nPos = key.codePointAt(i) - 13;
                    nLetter = String.fromCharCode(nPos);
                    nKey = nKey + nLetter;
                }
                return nKey;
            }

        })
   
        
        </script>

<!--Custom CSS-->
        <style type="text/css">
            body{
                background-attachment: fixed;
	            background-size: cover;
	            background-repeat: no-repeat;
            }

            .bd1 {
                border: 1px solid white;                
            }

            h1{
                font-size: 30px;
                margin: 0px;
                font-family: Courier;
            }

            h2 {
                color: white
            }

            h3 {
                color: white;
            }

            .nav{                
                color: white;
                background-color: #232323;
                padding: 2% 0% 2% 0%;
            }

            .phbb {
                height: 5px; 
                background-color: #eeeeee
            }

            #loading {
                color: white;
                font-size: 20px;
                margin: 2%
            }

            #weather {
                background-color: rgba(0,0,0,0.8);
                width: 600px;
                margin: calc(20px + 1vw) auto 0 auto;
                padding: 1%;
                display: block;
                border-radius: 20px;
            }

            img {
                border-radius: 10px;
            }

            canvas {
                display: block;
                margin: auto;
            }

        </style>
    </head>

<!--Body-->
    <body>
        <div class="container-fluid">
            <!--Navbar-->
            <div class="row phbb"></div>
            <div class="nav row">
                <div class="col-sm-9">
                    <h1>
                        <span class="fa fa-free-code-camp"></span>
                            freeCodeCamp Weather
                        <span class="fa fa-snowflake-o"></span>
                    </h1>
                </div>
                <div class="col-sm-3">
                    <input id="toggle" type="checkbox" data-toggle="toggle" data-on="&deg Celsius" data-off="&deg Fahrenheit" checked>
                </div>
            </div>            
            <div class="row phbb"></div>        

            <div id="weather">
                <p id="loading">Loading weather . . . . . </p>
                <h2 id="city" class="text-center">City</h2>
                <canvas id="canvas" width="100" height="100"></canvas>
                <!--Forecast for right now-->
                <div style="padding: 0 20px 0 20px;">
                    <h2 id="now">Right now:</h2>
                    <h3 id="summary" class="text-center">Summary</h3>
                    <h3 id="temp" class="text-center">temperature</h3>
                    <h3 id="wind" class="text-center">windSpeed</h3>
                </div>

                <!--forecast for the day-->
                <div style="padding: 0 20px 0 20px;">
                    <h2 id="later">Today:</h2>
                    <div class="row">
                        <div class="col-sm-6">
                            <h3 id="todSum" class="text-center">Today Summary</h3>
                        </div>
                        <div class="col-sm-6">
                            <h3 id="todWind" class="text-center">Today Wind</h3>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-6">
                            <h3 id="todTempMin" class="text-center">TodMin</h3>
                        </div>
                        <div class="col-sm-6">
                            <h3 id="todTempMax" class="text-center">TodMax</h3>
                        </div>
                    </div>
                </div>

                <!--forecast for the tomorrow-->
                <div style="padding: 0 20px 0 20px;">
                    <h2>Tomorrow:</h2>
                    <div class="row">
                        <div class="col-sm-6">
                            <h3 id="tomSum" class="text-center">Tomorrow Summary</h3>
                        </div>
                        <div class="col-sm-6">
                            <h3 id="tomWind" class="text-center">Tomorrow Wind</h3>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-6">
                            <h3 id="tomTempMin" class="text-center">TomMin</h3>
                        </div>
                        <div class="col-sm-6">
                            <h3 id="tomTempMax" class="text-center">TomMax</h3>
                        </div>
                    </div>
                </div>
                            
            </div>
            <p style="color: white;">Powered by:</p>
            <img src="http://tinyurl.com/y9jjn3bb">        
        </div>
    
    </body>

</html>

